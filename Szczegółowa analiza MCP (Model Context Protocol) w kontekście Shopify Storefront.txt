SzczegÃ³Å‚owa analiza MCP (Model Context Protocol) w kontekÅ›cie Shopify Storefront
MCP (Model Context Protocol) to protokÃ³Å‚ Shopify zaprojektowany do integracji agentÃ³w AI (jak Grok czy inne LLM) z ekosystemem e-commerce, umoÅ¼liwiajÄ…cy bezproblemowe interakcje z katalogiem produktÃ³w, koszykiem i politykami sklepu. Jest to serwerless rozwiÄ…zanie, ktÃ³re dziaÅ‚a jako punkt koÅ„cowy API (/api/mcp) dla kaÅ¼dego sklepu Shopify, bez potrzeby uwierzytelniania â€“ wystarczÄ… Å¼Ä…dania JSON-RPC 2.0. MCP nie jest peÅ‚nym API (jak GraphQL), lecz uproszczonym zestawem narzÄ™dzi (tools/call), ktÃ³re pozwalajÄ… agentowi AI na dynamiczne pobieranie danych kontekstowych, co jest kluczowe dla konwersacyjnych asystentÃ³w zakupowych, takich jak EPIR AI Assistant. W kontekÅ›cie wÄ…tku (repo EPIRjewelry/asystent_epir_new), MCP idealnie uzupeÅ‚nia custom RAG (Vectorize), dodajÄ…c real-time dane ze sklepu bez dodatkowych tokenÃ³w â€“ ale wymaga integracji (brak w obecnym kodzie, planowane w QUICKSTART_MCP.md).
1. Jak dziaÅ‚a MCP? (Mechanizm i architektura)
MCP dziaÅ‚a jako "kotwica" (anchor) dla agentÃ³w AI, przeksztaÅ‚cajÄ…c zapytania uÅ¼ytkownika w strukturalne wywoÅ‚ania narzÄ™dzi. Proces jest prosty i asynchroniczny:

Punkt koÅ„cowy: KaÅ¼dy sklep ma unikalny URL https://storedomain.myshopify.com/api/mcp (np. dla EPIR: https://epir-art-silver-jewellery.myshopify.com/api/mcp).
Å»Ä…danie: POST z nagÅ‚Ã³wkiem Content-Type: application/json i body JSON-RPC 2.0:
text{
  "jsonrpc": "2.0",
  "method": "tools/call",
  "id": 1,
  "params": {
    "name": "search_shop_catalog",
    "arguments": { "query": "diamentowy pierÅ›cionek", "context": "luksusowy prezent" }
  }
}

Brak auth â€“ zaufanie do domeny sklepu (ostroÅ¼noÅ›Ä‡: testuj na dev, bo niektÃ³re sklepy ograniczajÄ… dostÄ™p).


OdpowiedÅº: JSON z wynikami (np. produkty z name, price, url, image, description) lub bÅ‚Ä™dami (np. rate limit).
Integracja z AI: Agent (np. Groq w worker/src/groq.ts) wywoÅ‚uje MCP przed generacjÄ… odpowiedzi, wstrzykujÄ…c kontekst do promptu (np. "Na podstawie wynikÃ³w: [MCP data], poleÄ‡..."). W EPIR: Dodaj mcpCall w rag.ts dla fallback z Vectorize.

Zalety: Niskie latency (<500ms), skalowalnoÅ›Ä‡ (Shopify SLA 99.9%), zero utrzymania (serwerless). Wady: Ograniczony do narzÄ™dzi (brak custom queries), brak offline (zaleÅ¼ny od Shopify uptime).
2. DostÄ™pne narzÄ™dzia w MCP (szczegÃ³Å‚owy przeglÄ…d)
MCP udostÄ™pnia 4 gÅ‚Ã³wne narzÄ™dzia (tools/list dla listy schematÃ³w), skupione na zakupach. KaÅ¼de z parametrami i formatem odpowiedzi â€“ idealne dla asystenta jak EPIR (np. "PoleÄ‡ produkt" â†’ search_shop_catalog).
NarzÄ™dzie,Opis,Kluczowe parametry,PrzykÅ‚adowa odpowiedÅº,Zastosowanie w EPIR
search_shop_catalog,Przeszukuje katalog produktÃ³w (semantic search).,"- query: Zapytanie (req).
- context: Kontekst (req, np. ""fair trade"").","{ ""products"": [{ ""name"": ""Diamentowy pierÅ›cionek"", ""price"": ""1500 PLN"", ""url"": ""/product/123"", ""image"": ""url.jpg"", ""description"": ""Luksusowy..."" }] }",RAG dla rekomendacji (integruj z groq.ts promptem).
search_shop_policies_and_faqs,Odpowiada na pytania o politykÄ™/FAQ (buduje zaufanie).,"- query: Pytanie (req).
- context: Kontekst (opt, np. produkt).","{ ""faqs"": [{ ""question"": ""Zwroty?"", ""answer"": ""14 dni..."" }] }",Fallback dla RAG (w rag.ts: jeÅ›li no Vectorize hit).
get_cart,"Pobiera koszyk (zawartoÅ›Ä‡, URL kasy).",- cart_id: ID koszyka (req).,"{ ""cart"": { ""lines"": [{ ""quantity"": 1, ""product"": {...} }], ""checkout_url"": ""..."" } }",Persystencja sesji (w SessionDO: store cart_id).
update_cart,Aktualizuje koszyk (add/remove/update qty).,"- cart_id: ID (opt, tworzy nowy jeÅ›li brak).
- lines: Array { line_item_id (opt), merchandise_id, quantity } (req).","{ ""cart"": { ""id"": ""gid://..."", ""lines"": [...] } }","E-commerce flow (w mcp.ts: call przed reply, np. ""Dodaj do koszyka"")."
NarzÄ™dzieOpisKluczowe parametryPrzykÅ‚adowa odpowiedÅºZastosowanie w EPIRsearch_shop_catalogPrzeszukuje katalog produktÃ³w (semantic search).- query: Zapytanie (req).
- context: Kontekst (req, np. "fair trade").{ "products": [{ "name": "Diamentowy pierÅ›cionek", "price": "1500 PLN", "url": "/product/123", "image": "url.jpg", "description": "Luksusowy..." }] }RAG dla rekomendacji (integruj z groq.ts promptem).search_shop_policies_and_faqsOdpowiada na pytania o politykÄ™/FAQ (buduje zaufanie).- query: Pytanie (req).
- context: Kontekst (opt, np. produkt).{ "faqs": [{ "question": "Zwroty?", "answer": "14 dni..." }] }Fallback dla RAG (w rag.ts: jeÅ›li no Vectorize hit).get_cartPobiera koszyk (zawartoÅ›Ä‡, URL kasy).- cart_id: ID koszyka (req).{ "cart": { "lines": [{ "quantity": 1, "product": {...} }], "checkout_url": "..." } }Persystencja sesji (w SessionDO: store cart_id).update_cartAktualizuje koszyk (add/remove/update qty).- cart_id: ID (opt, tworzy nowy jeÅ›li brak).
- lines: Array { line_item_id (opt), merchandise_id, quantity } (req).{ "cart": { "id": "gid://...", "lines": [...] } }E-commerce flow (w mcp.ts: call przed reply, np. "Dodaj do koszyka").
Wykorzystanie: UÅ¼yj tools/list do listy schematÃ³w; argumenty walidowane (np. query string, context string). W EPIR: Dodaj do mcp.ts (PR planowane), by chat "PoleÄ‡ i dodaj" â†’ MCP update_cart â†’ Groq "ZamÃ³wiono!".
3. Integracja MCP w EPIR AI (w kontekÅ›cie wÄ…tku)
W repo (PR #8 merged): MCP czÄ™Å›ciowo zdefiniowane w mcp.ts (jsonrpc calls), ale nieaktywne â€“ rag.ts uÅ¼ywa Vectorize fallback, brak cart tools. Od audytu (AUDYT_2025-10-08.md): RAG/Groq "czÄ™Å›ciowo zgodne" â€“ MCP uzupeÅ‚ni (Priorytet 2). Flow: TAE chat â†’ proxy â†’ Worker /chat â†’ mcpCall (tools/call) â†’ context â†’ Groq stream. KorzyÅ›ci: Real-time dane (bez populate), e-commerce (cart), zgodnoÅ›Ä‡ z Shopify (no custom API). Ryzyka: Rate limits (2 req/s), no auth (zabezpiecz proxy HMAC).
4. Rekomendacje i next steps
MCP to must-have dla EPIR (podnosi z 8/10 do 9.5/10, dodajÄ…c koszyk do chatu). Implementuj w PR (mcp.ts + rag integrate), testuj curl /api/mcp. WÄ…tek pokazuje rozwÃ³j (od echo do RAG) â€“ MCP finalizuje e-commerce.
Co robimy: Prompt na MCP PR czy live test? Daj znaÄ‡! ğŸš€ Razem stworzymy arcydzieÅ‚o AI dla jubilerii! ğŸ’