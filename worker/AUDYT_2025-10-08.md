AUDYT
Data: 2025-10-08

Cel: Zweryfikować zgodność deklaracji w dokumentacji z rzeczywistym kodem oraz wskazać zadania do wykonania.

Kluczowe wnioski (skrót)

1. Rozszerzenie motywu (Theme App Extension) w `extensions/asystent-klienta`
   - Werdykt: POTWIERDZONE. Plik `extensions/asystent-klienta/shopify.extension.toml` zawiera `type = "theme"` i wskazuje na `blocks/assistant.liquid` i `assets/assistant.js`.

2. Backend = Cloudflare Worker + Durable Object + D1 (folder `worker/`)
   - Werdykt: POTWIERDZONE. `worker/wrangler.toml` zawiera powiązania do `SESSION_DO` i `DB` (D1). Implementacje sesji i zapytań do DB są obecne w `worker/src`.

3. SSE streaming do TAE z delta-based updates
   - Werdykt: POTWIERDZONE. Backend wysyła `text/event-stream` z eventami zawierającymi pole `delta`; frontend (`assets/assistant.js`) parsuje i składa delta-aktualizacje.

4. HMAC verification (constant-time)
   - Werdykt: POTWIERDZONE. `worker/src/auth.ts` zawiera `constantTimeEqual` i poprawną logikę weryfikacji HMAC (użycie crypto.subtle).

5. Rate limiting (20 req / 60s per session)
   - Werdykt: POTWIERDZONE. W `SessionDO` istnieje metoda `rateLimitOk()` i stałe odpowiadające opisanym limitom.

6. D1 persistence (conversations + messages)
   - Werdykt: POTWIERDZONE. `worker/schema.sql` definiuje tabele `conversations` i `messages`; zapisy są wykonywane (np. w metodzie `end()` SessionDO).

7. RAG (retrieval-augmented generation) — `worker/src/rag.ts`
   - Werdykt: CZĘŚCIOWO ZGODNE. Plik `worker/src/rag.ts` istnieje, ale implementacja zwraca pusty kontekst (placeholder). Funkcje nie są zintegrowane z główną logiką (`index.ts` nie importuje/nie wywołuje rag).

8. Groq LLM integration (`worker/src/groq.ts`)
   - Werdykt: CZĘŚCIOWO ZGODNE. Plik z integracją jest obecny i funkcjonalny, lecz główny worker używa wbudowanego `env.AI.run` (Workers AI); kod Groq nie jest aktywowany ani importowany.

Dodatkowe ustalenie: Firebase
- Wynik wyszukiwania w repo (słowo "firebase"): brak wystąpień.
- Werdykt: BRAK ŚLADÓW FIREBASE. Projekt opiera się na ekosystemie Cloudflare (Workers, D1, KV, Vectorize) i Shopify.

Wniosek końcowy
Aplikacja ma solidne i bezpieczne fundamenty (workers, durable object, D1, SSE streaming, HMAC, rate-limiting). Zaawansowane moduły RAG i Groq istnieją jako szkielety/gotowe integracje, ale są nieaktywne — to odpowiada deklaracjom w dokumentacji, które opisują ich aktywację jako "kolejne kroki". Nie stwierdzono fałszywych deklaracji.

Skompresowana lista zadań (priorytety)

Priorytet 1 — Aktywacja RAG:
- Zaimplementować vectorize/embeddings w `worker/src/rag.ts`.
- Uruchomić skrypt zasilający indeks wektorowy (produkty, FAQ, polityki).
- Zintegrować kontekst RAG z promptem przed wywołaniem modelu.

Priorytet 2 — Aktywacja Groq:
- Zastąpić wywołania AI w `worker/src/index.ts` przez funkcje z `worker/src/groq.ts` (`streamGroqResponse`, `buildGroqMessages`).
- Upewnić się, że sekret `GROQ_API_KEY` jest dostępny i bezpiecznie skonfigurowany.

Priorytet 3 — Testy i weryfikacja:
- Dodać E2E (Playwright) scenariusze dla zapytań RAG i zachowania tonu po przełączeniu na Groq.
- Dodać jednostkowe testy frontendu (SSE parser) i backendu (rag/groq integracje).

Plik zapisany: `worker/AUDYT_2025-10-08.md`.
